<div class="modal noselect" id="pokedexModal" tabindex="-1" role="dialog"
aria-labelledby="pokedexModalLabel">
<div class="modal-dialog modal-dialog-scrollable modal-lg pokedex-modal" role="document">
   <div class="modal-content">
       <div class="modal-header">
           <h4 style="margin-bottom: 0">Pokédex</h4>
           <button style="float:right;" class="btn btn-secondary d-block d-lg-none" type="button" data-toggle="collapse"
                   data-target="#pokedex-filter-collapse" aria-expanded="false" aria-controls="pokedex-filter-collapse">
               Filters
           </button>
       </div>
       <div class="modal-body row mx-0">
            <div class="col-lg-3 collapse dont-collapse-sm" id="pokedex-filter-collapse">
                <div class="w-100 mb-2" style="border-bottom: 1px solid #eceeef">
                    <h4>Filters and Settings</h4>
                </div>
                <div class="container-fluid pl-0" id="pokedex-filter-container">
                    <div class="form-row text-left">
                        <!--Name-->
                        <div class="form-group col-md-6 col-6">
                            <label>Name</label>
                            <input id="nameFilter" class="form-control" placeholder="Crobat" value=""
                            oninput="PokedexFilters.name.value(new RegExp(`(${/^\/.+\/$/.test(this.value) ? this.value.slice(1, -1) : GameHelper.escapeStringRegex(this.value)})`, 'i'))">
                        </div>

                        <!--Region-->
                        <div class="form-group col-md-6 col-6">
                            <label>Region</label>
                            <select id="pokedex-filter-region" class="custom-select"
                                data-bind="options: PokedexFilters.region.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.region.value" 
                                style="margin-right: 8px">
                            </select>
                        </div>

                        <!--Types-->
                        <div class="form-group col-md-6 col-6">
                            <label>Types</label>
                            <select id="pokedex-filter-type1" class="custom-select" style="margin-right: 8px"
                                data-bind="options: PokedexFilters.type1.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.type1.value">
                            </select>
                        </div>
                        <div class="form-group col-md-6 col-6">
                            <label> </label>
                            <select id="pokedex-filter-type2" class="custom-select"
                                data-bind="options: PokedexFilters.type2.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.type2.value">
                            </select>
                        </div>

                        <div class="form-group col-md-6 col-6">
                            <label for="pokedex-filter-shiny-caught">Caught Status</label>
                            <select id="pokedex-filter-shiny-caught" autocomplete="off" class="custom-select" 
                                data-bind="options: PokedexFilters.caughtShiny.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.caughtShiny.value">
                            </select>
                        </div>

                        <div class="form-group col-md-6 col-6">
                            <label for="pokedex-filter-pokerus-status">Pokerus Status</label>
                            <select id="pokedex-filter-pokerus-status" autocomplete="off" class="custom-select" 
                                data-bind="options: PokedexFilters.statusPokerus.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.statusPokerus.value">
                            </select>
                        </div>

                        <!-- Category -->
                        <div class="form-group col-md-6 col-6">
                            <label for="pokedex-filter-category">Category</label>
                            <div class="dropdown show">
                                <button type="button" class="text-left custom-select col-12 btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                    data-bind="text: PokedexFilters.category.value() == -1 ? 'All' : PokemonCategories.categories()[PokedexFilters.category.value()].name()">
                                    Categories
                                </button>
                                <div class="border-secondary dropdown-menu col-12">
                                    <div class="dropdown-item dropdown-text" data-bind="click : function(){ Settings.setSettingByName('pokedexCategoryFilter', -1) }">
                                        All
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <!-- ko foreach : PokemonCategories.categories -->
                                    <div class="dropdown-item" data-bind="text : $data.name(), style: { background: $data.color() },
                                        click : function(){ Settings.setSettingByName('pokedexCategoryFilter', $index()) }">
                                    </div>
                                    <!-- /ko-->
                                </div>
                            </div>
                        </div>

                         <!-- Mega Evolution -->
                         <div class="form-group col-md-6 col-6">
                            <label for="pokedex-filter-unique-transformation">Unique Forms</label>
                            <select id="pokedex-filter-unique-transformation" autocomplete="off" class="custom-select" 
                                data-bind="options: PokedexFilters.uniqueTransformation.options,
                                    optionsValue: 'value',
                                    optionsText: 'text',
                                    value: PokedexFilters.uniqueTransformation.value">
                            </select>
                        </div>

                        <!-- Rare Hold Item -->
                        <div class="form-group col-md-9 col-6">
                            <span>Rare Hold Item</span>
                            <i class="bi bi-question-circle mx-1" data-bind="tooltip: { title: 'Filters Pokémon with a chance to drop an item', trigger: 'hover' }"></i>
                        </div>
                        <div class="form-group col-md-3 col-6">
                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="form-check-input" type="checkbox" id="pokedex-filter-held-item"
                                        value="false" data-bind="checked: PokedexFilters.heldItem.value">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                            </label>
                        </div>
                        <!--Hide alternate forms-->
                        <div class="form-group col-md-9 col-6">
                            <span>Alternate forms</span>
                            <i class="bi bi-question-circle mx-1" data-bind="tooltip: { title: 'Filters all alternate forms out', trigger: 'hover' }"></i>
                        </div>
                        <div class="form-group col-md-3 col-6">
                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="form-check-input" type="checkbox" id="pokedex-filter-hide-alternate"
                                        value="false" data-bind="checked: PokedexFilters.hideAlternate.value">>
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                            </label>
                        </div>

                        <!-- Gender differences -->
                        <div class="form-group col-md-9 col-6">
                            <span>Gender differences</span>
                            <i class="bi bi-question-circle mx-1" data-bind="tooltip: { title: 'Filters all Pokémon with gender differences', trigger: 'hover' }"></i>
                        </div>
                        <div class="form-group col-md-3 col-6">
                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="form-check-input" type="checkbox" id="pokedex-filter-gender-diff"
                                    value="false" data-bind="checked: PokedexFilters.genderDiff.value">>
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                            </label>
                        </div>
                        <div class="col-12">
                            <hr style="margin-top:0; border-color:white;"/>
                        </div>
                        <!-- Show/Hide Shiny images -->
                        <div class="form-group col-md-9 col-6">
                            <span>Shiny images</span>
                            <i class="bi bi-question-circle mx-1" data-bind="tooltip: { title: 'Shows Shiny image of Pokémon with its Shiny variant unlocked', trigger: 'hover' }"></i>
                        </div>
                        <div class="form-group col-md-3 col-6">
                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="form-check-input" type="checkbox" id="pokedex-filter-held-item"
                                    data-bind="checked: PokedexHelper.toggleAllShiny">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                            </label>
                        </div>
                        <!-- Show/Hide Female images -->
                        <div class="form-group col-md-9 col-6">
                            <span>Female images</span>
                            <i class="bi bi-question-circle mx-1" data-bind="tooltip: { title: 'Shows female image of Pokémon with gender differences', trigger: 'hover' }"></i>
                        </div>
                        <div class="form-group col-md-3 col-6">
                            <label class="form-check-label toggler-wrapper style-1 float-right">
                                <input class="form-check-input" type="checkbox" id="pokedex-filter-held-item"
                                    data-bind="checked: PokedexHelper.toggleFemale">
                                <div class="toggler-slider">
                                    <div class="toggler-knob"></div>
                                </div>
                            </label>
                        </div>
                   </div>
               </div>

            </div>
            <div class="col-lg-9">
                <!-- ko if: PokedexHelper.filteredList().length == 0 -->
                <div class="row justify-content-center w-100 mb-2" style="border-bottom: 1px solid #eceeef">
                    <h4 data-bind="text: 'No Pokémon found'"></h4>
                </div>
                <span>Missing a Pokémon but don't see it here? Be sure to completely explore the region!</span>
                <!-- /ko -->
                <!-- ko if: PokedexHelper.filteredList().length != 0 -->
                <div class="row justify-content-center w-100 mb-2" style="border-bottom: 1px solid #eceeef">
                    <h4 data-bind="text: `Showing ${PokedexHelper.filteredList().length} Pokémon`"></h4>
                </div>
                <!-- /ko -->
                <div id="pokemon-list">
                    <div class="row justify-content-center mw-100 p-0 m-0 pokedex-list" id="pokedex-pokemon-list" data-bind="foreach: lazyLoad($element, PokedexHelper.filteredList, { reset: PokedexHelper.resetFilter })">
                        <!-- Pokemon Entry -->
                        <div class="col-12 col-sm-4 col-md-3 col-lg-2 pokedexEntry"
                            data-bind="style: { background: PokedexHelper.getBackgroundColors($data.name)}">

                            <!-- Pokemon ID -->
                            <span class="pokemon-id" data-bind="text: '#' + ($data.id > 0 ? Math.floor($data.id) + '' : '???').padStart(3, 0)">number</span>
                            
                            <!-- ko if: App.game.party.alreadyCaughtPokemonByName($data.name) -->

                            <!-- Pokemon Caught Status -->
                            <!-- ko using: PartyController.getCaughtStatus($data.id), as: 'caughtStatus' -->
                            <knockout class="caught-status-icon" data-bind="template: { name: 'caughtStatusTemplate', data: {'status': caughtStatus}}"></knockout>
                            <!-- /ko -->

                            <!-- ko using: App.game.party.getPokemon($data.id)?.pokerus, as: 'pokerusStatus' -->
                            <div class="pokerus-status" data-bind="if: pokerusStatus">
                                <knockout data-bind="template: { name: 'pokerusStatusTemplate', data: { 'pokerus': pokerusStatus, 'width': '32px' } }">Pokerus icon</knockout>
                            </div>
                            <!-- /ko -->

                            <!-- Pokemon Mega Stone -->
                            <!-- ko if: App.game.party.getPokemon($data.id)?.megaStone -->
                            <div class="mega-icon-container item-icon-right">
                                <div class="item-icon rounded-circle">
                                    <img class="mw-100 mh-100 p-0" src="" width="24px" style="vertical-align: unset;" data-bind="attr: { src: App.game.party.getPokemon($data.id).megaStone.getImage() }">
                                </div>
                            </div>
                            <!-- /ko -->
                            
                            <!-- /ko -->

                            <!-- Pokemon Sprite -->
                            <img src="" width="" data-bind="css: { 
                                'pokemon-not-seen': !PokedexHelper.pokemonSeen($data.id)(), 
                                'pokemon-seen-but-not-caught': !App.game.party.alreadyCaughtPokemonByName($data.name) && PokedexHelper.pokemonSeen($data.id)() 
                            }, 
                            attr:{ 
                                src: PokemonHelper.getImage($data.id, App.game.party.alreadyCaughtPokemon($data.id, true) && PokedexHelper.toggleAllShiny(), PokedexHelper.toggleFemale()),
                                width: '96px'
                            }">

                            <!-- Pokemon Name -->
                            <!-- ko if: PokedexHelper.pokemonSeen($data.id) -->
                            <span class="enemy-name" data-bind="using: PokemonHelper.displayName($data.name)(), as: 'displayName'">
                                <knockout class="" data-bind="text: displayName, css: { 'marquee': displayName.length > 18 }">name</knockout>
                            </span>
                            <!-- /ko -->

                            <!-- Pokemon Rare Hold Item (Drop) -->
                            <!-- ko if: $data.heldItem && BagHandler.displayName($data.heldItem) && App.game.party.alreadyCaughtPokemonByName($data.name) -->
                            <div class="item-icon-container item-icon-right">
                                <div class="item-icon rounded-circle">
                                    <img class="mw-100 mh-100 p-0" src="" width="24px" style="vertical-align: unset;" data-bind="attr: { src: BagHandler.image($data.heldItem) }">
                                </div>
                            </div>
                            <!-- /ko -->

                            <!-- Overlay Link -->
                            <!-- ko if: PokedexHelper.pokemonSeen($data.id) -->
                            <a class="overlay" href="#pokemonStatisticsModal" data-toggle="modal" data-bind="click: () => {App.game.statistics.selectedPokemonID($data.id)},
                                tooltip: {
                                    html: true,
                                    title: `<u>Information:</u>
                                        <br/>Base Attack: <strong>${$data.attack}</strong>
                                        <br/>Catch Rate: <strong>${PokemonFactory.catchRateHelper($data.catchRate, true)}%</strong>
                                        <br/>Hatch Steps: <strong>${App.game.party.getPokemon($data.id)?.getEggSteps().toLocaleString('en-US') || 'Unknown'}</strong>` +
                                        (App.game.party.getPokemon($data.id)?.pokerus >= GameConstants.Pokerus.Contagious ?
                                            `<br/>EVs: <strong>${App.game.party.getPokemon($data.id).evs().toLocaleString('en-US')}</strong>
                                            <br/>EV bonus: <strong>×${App.game.party.getPokemon($data.id).calculateEVAttackBonus().toLocaleString('en-US')}</strong>`
                                            : '') +
                                            (App.game.party.getPokemon($data.id)?.megaStone ?
                                                `<br/>${App.game.party.getPokemon($data.id).megaStone.getTooltipText()}`
                                            : ''),
                                    trigger: 'hover',
                                    placement:'bottom'
                                }">
                            </a>
                            <!-- Category Button -->

                            <!-- ko if: App.game.party.alreadyCaughtPokemonByName($data.name) -->
                            <div class="pokemonCategory dropdown">
                                <button data-toggle="dropdown" data-bind="class: `category-${App.game.party.getPokemon($data.id).category + 1}`"></button>
                                <div class="dropdown-menu p-0">
                                    <!-- ko foreach: { data: PokemonCategories.categories, as: 'pokemonCategory' } -->
                                    <a class="dropdown-item category" href="#" data-bind="text: pokemonCategory.name, style: { background: pokemonCategory.color, 'text-shadow': '0 0 6px black' }, click: () => { App.game.party.getPokemon($parent.id).category = $index() }">Category</a>
                                    <!-- /ko -->
                                    <a class="dropdown-item bg-dark py-1" href="#categoryModal" data-toggle="modal"><i>Edit</i></a>
                                </div>
                            </div>
                            <!-- /ko -->

                            <!-- /ko -->
                        </div>
                    </div>
                </div>
            </div>
       </div>

       <div class="modal-footer">
           <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
       </div>
   </div>
</div>
</div>
